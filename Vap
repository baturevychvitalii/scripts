#!/bin/zsh

if [[ "$1" = "-h" || "$1" = "--help" || "$1" = "help" ]]; then
	echo "Usage:"
	echo "\tVap [-n(no internet),clients]";
	exit 0;
fi

if [ "$1" = "clients" ]; then
	create_ap --list-clients $(create_ap --list-running | tail -n 1 | cut -d ' ' -f 1,1);
	exit 0;
fi


. Vlib.sh
hotspot_mac="f8:1a:67:af:1b:c3";
optionz="--mac $hotspot_mac --hidden";
cridentials="gringo G350nslz831rV";
interface="$(PICK_WIRELESS_INTERFACE $WIRELESS_PREFFERED_INTERFACE)";

if [ interface = "NULL" ]; then
	echo "requested interface isn't plugged in";
	exit 1;
fi

if ps -e | grep -q "create_ap"; then
	echo "access point already exists";
	exit 1;
fi

echo "Access point will be created on $interface";

if [ "$2" = "-n" ]; then
	zsh -c "sudo create_ap -n $optionz $interface $cridentials"
else
	zsh -c "sudo create_ap $optionz $interface $interface $cridentials"
fi
exit 0;

